\documentclass{elsart}
\usepackage[numbers]{natbib}
\newcommand{\threej}[6]{\ensuremath{\left({#1\atop #4}{#2\atop #5}
{#3\atop #6}\right)}}
\newcommand{\sixj}[6]{\ensuremath{\left\{{#1\atop #4}{#2\atop #5}
{#3\atop #6}\right\}}}

\newcommand{\pra}{Phys. Rev. A}
\newcommand{\cpc}{Comput. Phys. Commun.}
\newcommand{\jpb}{J. Phys. B}
\newcommand{\mnras}{Mon. Not. R. Astron. Soc.}
\newcommand{\josa}{J. Opt. Soc. Ame.}
\newcommand{\jqsrt}{J. Quant. Spectros. Rad. Transf.}

\begin{document}

\begin{frontmatter}

\title{Flexible Atomic Code: I. Atomic Structure} 
\author{Ming Feng Gu}
\address{Massachusetts Institute of Technology, Cambridge, MA 02139, USA}

\begin{abstract}
In this and subsequent papers, we describe a complete software package for
the computation of various atomic processes, such as atomic structure,
radiative transition, electron impact excitation and ionization,
photoionization, autoionization, and their inverse processes, radiative and
dielectronic recombination. This paper deals with the atomic structure part
and the calculation of radiative transition rates. The bound states of the
atomic system are calculated in the configuration mixing approximation with
convenient specification of mixing schemes. The radial orbitals for the
construction of basis states are derived from a modified self-consistent
Dirac-Fock-Slater 
iteration on a fictitious mean configuration with fractional occupation
numbers. The radiative transition rates are calculated in the single multipole
approximation with arbitrary ranks. The interference between 
different multipoles is neglected. 
\end{abstract}

\begin{keyword}
Atomic structure \sep Radiative transition
\PACS 31.15.-p \sep 32.70.Cs
\end{keyword}
\end{frontmatter}

\textbf{\large PROGRAM SUMMARY}

Title of program: FAC

Catalogue identifier:

Distribution formate:

Computer for which the program is designed and others on which the program has
been tested:\\
Computers: Sun Workstations, PCs\\
Operating systems under which the program has been tested: Unix

Programming language used: C, Fortran, Python

Number of bits in a word: 64

Number of processors used: 1

Has the code been vectorized or parallelized: No

Keywords: Atomic structure, Radiative transition.

Nature of physical problem: Accurate energy levels of atomic ions and the
radiative transition rates between these levels are essential for the
interpretation of laboratory and astrophysical spectroscopic data.

Method of solution: A local central potential is constructed using a modified
self-consistent Dirac-Fock-Slater iteration on a fictitious mean configuration
with fractional occupation numbers. This central potential is then used to
derive radial orbitals which are in turn used to construct basis states which
allow for arbitrary mixing between configurations. The fully
relativistic Hamiltonian in the representation of these basis states is
diagonalized to derive the level energies and eigenstates. 

Restrictions on the complexity of program: No more than 2 electrons are
allowed in the relativistic subshells with $j > 9/2$. No other special
restrictions except for that of system resources.

Typical running time: The test run takes 1.17 seconds on an Ultra-10 Sun
Workstation. 

\textbf{\large LONG WRITE-UP}

\section{Introduction}
This is the first of a series of papers introducing a complete software
package, Flexible Atomic Code (FAC), for the computation of various atomic
radiative and collisional processes. A fully relativistic approach based on
the Dirac equation is used throughout the entire package which allows its
application to ions with large values of nuclear charge $Z$. Currently, FAC
is able to treat radiative transition, direct excitation and
ionization by electron impact, non-resonant photoionization and radiative
recombination, autoionization and dielectronic recombination. These processes
are essential for the interpretation of laboratory and astrophysical 
spectroscopic data. The main goal of creating such a comprehensive package is
to integrate various atomic processes within a single theoretical framework,
ensure the self-consistency between different parts, and provide a uniform,
flexible and easy-to-use user interface for accessing all the
functionalities. 

Many computer programs now exist for the calculation of atomic processes,
using either non-relativistic approximations (some including relativistic
effects through the Breit-Pauli Hamiltonian) or fully relativistic
methods. Most of them are mainly concerned with the atomic structure part and
bound-bound processes, e.g., the non-relativistic configuration interaction
codes CIV3 \citep{hibbert75} and SUPERSTRUCTURE \citep{eissner74}, the widely
used program of \citet{cowan81}, the multi-configuration Hartree-Fock (MCHF)
program of \citet{fischer00}, and the multi-configuration Dirac-Fock (MCDF)
code of \citet{grant80}. Many newer programs for continuum processes make use
of the output from these structure codes for bound states wave functions. This
sometimes leads to 
a different treatment of continuum states from that of bound states. More
importantly, the communication between different programs tends to complicate
the user interface, and makes it difficult for people other than the authors
of the codes to efficiently use them. 

There also exist several integrated
packages for the calculation of a variety of processes, e.g., the ATOM package
\citep{amusia97}, the HULLAC package \citep{barshalom01}, and the fully
relativistic code (SZ) of \citet{sampson89} and \citet{zhang89}. These
programs treat continuum as well as bound processes. In 
ATOM, the radial wave functions for bound and continuum orbitals are obtained
using the self-consistent field Hartree-Fock method or the frozen-core
Hartree-Fock method. A relativistic version based on the Dirac equation is
also available. Such a procedure tends to be very time consuming, especially
for continuum processes, where the number of continuum orbitals needed is
large. The HULLAC package and SZ are both based on the Dirac equation, and use
a single, local, central potential for the solution of radial orbitals. This
approach is very rapid because the orthogonality of 
different orbitals is automatically ensured. Both codes use the distorted wave
(DW) approximation for continuum processes. The difference between them is
mainly in the way the local central potential is obtained. In HULLAC, 
a parametric potential is used and the parameters in the potential are derived
by minimizing the average energies of some selected configurations
\citep{klapisch77}. In SZ, one 
constructs a fictitious mean configuration with fractional occupation numbers
that takes into account all configurations involved in the physical processes
to be calculated. A self-consistent Dirac-Fock-Slater iteration is then
performed on this mean configuration to derive the local central potential. 
Although various results from these two codes have been published over the
years, the programs are not available to the general public. The present
package is intended for providing the general public, especially, the X-Ray
astrophysical community who are collecting large amounts of high resolution
spectroscopic data from the X-Ray observatories \textit{Chandra} and
\textit{XMM-Newton} an efficient, flexible, and accurate implementation of
the relativistic DW approximation.  

This paper presents the theoretical background, numerical techniques, and
practical usage related to the atomic structure calculation with FAC. In
\S\ref{sec_theory}, we outline the theory, and discuss the key numerical
techniques. \S\ref{sec_program} introduces the most important routines
relevant to the atomic structure calculation. \S\ref{sec_example} presents a step by step demonstration of the 
practical usage through the calculation of energy levels and radiative
transition rates of electric-dipole allowed transitions for Ne-like iron. The
results obtained are compared with those from other existing codes. 

\section{Theory and Numerical Techniques}
\label{sec_theory}
The energy levels of an atomic ion with $N$ electrons are obtained by
diagonalizing the relativistic Hamiltonian $H$. In atomic units, which we shall
use throughout the papers, it reads
\begin{equation}
\label{eq_hamilton}
H = \sum_{i=1}^{N} H_{D}(i) + \sum_{i<j}^{N}\frac{1}{r_{ij}},
\end{equation}
where $H_{D}(i)$ is the single-electron Dirac Hamiltonian for the potential
due to the nuclear charge. The basis states $\Phi_{\nu}$, which are usually
referred to as configuration state functions (CSF), are antisymmetric sums of
products of $N$ one-electron Dirac spinors $\varphi_{n\kappa m}$
\begin{equation}
\label{eq_spinor}
\varphi_{n\kappa m} = \frac{1}{r}\left(\begin{array}{c}
P_{n\kappa}(r) \chi_{\kappa m}(\theta, \phi, \sigma)\\
iQ_{n\kappa}(r) \chi_{-\kappa m}(\theta, \phi, \sigma)
\end{array}\right),
\end{equation}
where $\chi_{\kappa m}$ is the usual spin-angular function. $n$ is the
principal quantum number, $\kappa$ is the relativistic angular quantum number
, which is related to the orbital and total angular momentum through
\begin{equation}
\kappa = (l-j)(2j+1),
\end{equation}
and $m$ is the projection of the total angular momentum. In coupling the
angular momenta of successive shells, the standard $jj$ coupling scheme is
used. 

The approximate atomic state functions are given by mixing the basis
states $\Phi_{\nu}$ with same symmetries
\begin{equation}
\label{eq_asf}
\psi = \sum_{\nu} b_{\nu} \Phi_{\nu},
\end{equation}
where $b_{\nu}$ are the mixing coefficients obtained from diagonalizing the
total Hamiltonian. 

\subsection{Choice of Local Central Potential}
The one-electron radial orbitals must be known in order to construct the
Hamiltonian matrix. In the standard Dirac-Fock-Slater method, the large and
small components, $P_{n\kappa}$ and $Q_{n\kappa}$, satisfy the coupled Dirac
equation for a local central field $V(r)$
\begin{eqnarray}
\label{eq_dirac}
\left(\frac{\d}{\d r} + \frac{\kappa}{r}\right)P_{n\kappa} &=&
\alpha\left(\varepsilon_{n\kappa} - V + \frac{2}{\alpha^2}\right)Q_{n\kappa}
\nonumber\\
\left(\frac{\d}{\d r} - \frac{\kappa}{r}\right)Q_{n\kappa} &=&
\alpha\left(-\varepsilon_{n\kappa} + V\right)P_{n\kappa},
\end{eqnarray}
where $\alpha$ is the fine structure constant, and $\varepsilon_{n\kappa}$ are
the energy eigenvalues of the radial orbitals.

The local central potential $V$ includes the contribution from the nuclear
charge $V^N(r)$ and the electron-electron interaction $V^{ee}(r)$. The nuclear
potential can be written as
\begin{equation}
\label{eq_nuclear}
V^{N} = \Bigg\{\begin{array}{ll}
\frac{Z}{2}\left(\frac{r}{R_N}\right)
\left[3-\left(\frac{r}{R_N}\right)^2\right], & r \le R_N \nonumber\\
Z, & r > R_N
\end{array},
\end{equation}
where $R_N$ is the statistical model radius of the nucleus, which can be
expressed in terms of the atomic mass $A$, $R_N = 2.2677\times 10^{-5}
A^{1/3}$. In the standard Dirac-Fock-Slater method, which is the approach used
by SZ, the electron-electron interaction includes the spherically averaged
classical potential due to the bound electrons, and a local approximation to
the exchange interaction
\begin{eqnarray}
\label{eq_ee}
V^{ee}(r) &=& V_c(r) - \left[\frac{3}{4\pi^2 r^2}\sum_{n\kappa}
\omega_{n\kappa}\rho_{n\kappa}(r)\right]^{1/3}, \nonumber\\
V_c(r) &=& \sum_{n\kappa}\int \frac{\omega_{n\kappa}}{r_>}
\rho_{n\kappa}(r^\prime)\d r^{\prime}, \nonumber\\
\rho_{n\kappa}(r) &=& P_{n\kappa}^2(r) + Q_{n\kappa}^2(r), 
\end{eqnarray}
where $\omega_{n\kappa}$ is the occupation number of the subshell
$n\kappa$, and $r_>$ is the greater of $r$ and $r^{\prime}$. This potential
includes the undesirable self-interaction and has incorrect asymptotic
behavior. We shall use a slightly more complicated expression for $V^{ee}(r)$
\begin{eqnarray}
\label{eq_nee}
V^{ee}(r) &=& \frac{1}{r}\Big\{\sum_{ab}\omega_a(\omega_b - 
\delta_{ab})Y^0_{bb}(r)\rho_a(r) \nonumber\\
&&+\sum_a\omega_a(\omega_a-1)\sum_{k>0}f_{k}(a,a)Y^{k}_{aa}(r)\rho_a(r) 
\nonumber\\
&&+\sum_{a\ne b} \sum_k \omega_a\omega_b 
g_{k}(a,b) Y^{k}_{ab}(r)\rho_{ab}(r)\Big\} \Big/ \sum_a \omega_a\rho_a(r),
\end{eqnarray}
where $a = n\kappa$ and $b = n^\prime\kappa^\prime$ are the dummy indices
denoting the subshells and 
\begin{eqnarray}
\label{eq_yk} 
\rho_{ab} &=& P_a(r)P_b(r) + Q_a(r)Q_b(r) \nonumber\\
Y^k_{ab}(r) &=& r\int\frac{r_<^k}{r_>^{k+1}}\rho_{ab}(r^\prime)\d r^\prime,
\end{eqnarray}
where $r_<$ and $r_>$ are the lesser and greater of $r$ and $r^\prime$
respectively. $f_k$ and $g_k$ are the direct and exchange coefficients defined
as
\begin{eqnarray}
\label{eq_fg}
f_k(a,b) &=& -\left(1+\frac{1}{2j_a}\right)
\threej{j_a}{k}{j_b}{-\frac{1}{2}}{0}{\frac{1}{2}}^2 \nonumber\\
g_k(a,b) &=& -\threej{j_a}{k}{j_b}{-\frac{1}{2}}{0}{\frac{1}{2}}^2,
\end{eqnarray}
where \threej{j_1}{j_2}{j_3}{m_1}{m_2}{m_3} is the Wigner $3j$ symbol. Such a
choice for the electron-electron interaction is based on the fact that the
quantity 
\begin{equation}
\label{eq_Eee}
E^{ee} = \frac{1}{2}\sum_a\omega_a<a|V^{ee}|a> 
= \frac{1}{2}\sum_a\omega_a\int V^{ee}(r)\rho_a(r)\d r
\end{equation}
is the electron-electron contribution to the average energy of the
configuration. The factor $1/2$ in Equation \ref{eq_Eee} accounts for the
double counting of electron pairs in the above summation. It is easily seen
that Equation \ref{eq_nee} has the correct asymptotic behavior at large $r$,
since the self-interaction term is explicitly excluded.

In order to take into account more than one configuration involved in the
physical processes to be calculated, we do not use a single physical
configuration in the construction of the potential. Instead, a fictitious mean
configuration with fractional occupation numbers is used. As in SZ, this mean
configuration is usually obtained by distributing the active electrons in the
initial and final states. 
 
\subsection{Solution of Dirac Equations}
Since the potential depends on the radial orbitals sought, a self-consistent
iteration is required to solve Equations \ref{eq_dirac}. In each iteration,
the orbitals from the previous step are used to derive the
potential. Therefore, one needs to solve the eigenvalue problem with the known
potential. As is 
standard, we convert Equations \ref{eq_dirac} into a Schr\"{o}dinger-like
equation by 
eliminating the small component and performing the transformation
\citep{chernysheva99} 
\begin{eqnarray}
\label{eq_transform}
P_a &=& \xi_a(r) F_a(r) \nonumber \\
\xi_a(r) &=& \sqrt{1+\frac{\alpha^2}{2}\left[\varepsilon_a-V(r)\right]} 
\nonumber \\
Q_a &=& \frac{\alpha}{2\xi_a^2}\left(\frac{\d}{\d r}P_a + 
\frac{\kappa}{r}P_a\right),
\end{eqnarray}
Under this transformation, we have
\begin{equation}
\label{eq_schrodinger}
\frac{\d^2}{\d r^2}F_a(r) + \left\{2\left[\varepsilon_a-U(r)\right] - 
\frac{\kappa(\kappa + 1)}{r^2}\right\}F_a(r) = 0,
\end{equation}
where $U(r)$ is an effective potential defined as
\begin{eqnarray} 
\label{eq_UW}
U(r) &=& V(r) - \frac{\alpha^2}{2}\left\{\left[V(r) - \varepsilon_a\right]^2 
-W(r)\right\} \nonumber \\
W(r) &=& \frac{1}{4\xi^2(r)}\left[\frac{\d^2}{\d r^2}V(r) +
\frac{3\alpha^2}{4\xi^2(r)}\left(\frac{\d}{\d r}V(r)\right)^2 - 
\frac{2\kappa}{r}\frac{\d}{\d r}V(r)\right].
\end{eqnarray}

We use the standard Numerov method to solve Equation \ref{eq_schrodinger}. 
However, it is customary to perform another transformation before seeking the
solution
\begin{eqnarray}
t &=& t(r) \nonumber\\
F_a(r) &=& \left(\frac{\d t}{\d r}\right)^{-1/2} G_a(t),
\end{eqnarray}
where $t(r)$ as a function of radial distance is suitably chosen
so that a uniform grid can be used in the new variable $t$, and the
corresponding transformation on the wavefunction is to bring the differential
equation for $G_a(t)$ to a Schr\"{o}dinger-like form, i.e., without the first
derivative term
\begin{eqnarray}
\label{eq_Ga}
\frac{\d^2}{\d t^2}G_a(t) &=& \left(\frac{\d t}{\d r}\right)^{-2}G_a(t)
\Bigg\{\frac{\kappa(\kappa +1)}{r^2} - 2\left[\varepsilon_a-U(r)\right]
\nonumber\\
&+&\frac{1}{2}\left(\frac{\d t}{\d r}\right)^{-1}\frac{\d^3 t}{\d r^3}
-\frac{3}{4}\left(\frac{\d t}{\d r}\right)^{-2}\left(\frac{\d^2 t}{\d
r^2}\right)^2\Bigg\}.
\end{eqnarray}

Two types of $t(r)$ have been used in the past. One is a logarithmic
transformation, $t(r) \propto \ln(r)$, which has been used in the MCHF code of
\citet{fischer00}; the other is a hybrid form, $t(r) = c_1 r + c_2 \ln(r)$,
e.g., as used in ATOM \citep{amusia97}. The logarithmic form is not
suitable for 
highly excited and continuum orbitals, because the radial grid interval may
exceed the oscillation period of the wavefunction at large $r$. In the hybrid
form, the grid interval approaches a constant at large $r$. For suitably
chosen coefficients $c_1$ and $c_2$, it can be used in the calculation of
highly excited orbitals and continua with energy below some limit. However,
for free orbitals with sufficiently high energy, solving Equation \ref{eq_Ga}
in a conventional way becomes impractical. We shall use a different approach
for continuum states, namely, the phase-amplitude method. For highly excited
bound states, it is easily shown that the oscillation period of the
wavefunction is $\propto \sqrt{r}$ at large $r$. We, 
therefore, use a modified hybrid form $t(r) = c_1\sqrt{r} + c_2\ln(r)$ so that
one oscillation period contains approximately the same number of grid points
at large distances. The advantage of the modified form
over the linear hybrid form is that for a given number of grid points, the
modified form can cover a larger radial distance than the linear form, which is
important for the calculation of highly excited states. 

The minimum and maximum radial distances, $r_{min}$ and $r_{max}$, in setting
up the radial grid are chosen as 
\begin{eqnarray}
r_{min} &=& 10^{-5}/Z_{eff} \nonumber \\
r_{max} &=& 10^{3}/Z_{eff},
\end{eqnarray}
where $Z_{eff}$ is the residual charge of the atomic ion that the electrons
experience at large $r$. This ensures that $r_{min}$ is well within the
nuclear charge distribution for any atomic system. The value of
$r_{max}$ ensures that for excited states below $n \sim 30$, the bound energies
are less than the Coulomb potential at $r_{max}$. These states have no nodes at
$r > r_{max}$. For states with higher $n$, however, wavefunctions beyond
$r_{max}$ may have additional nodes. Therefore, counting the nodes is no
longer a valid method to pick out the right solution. Moreover, the
wavefunctions can no longer be normalized by calculating their norm with simple
numerical integration, since the contributions beyond $r_{max}$ cannot be
neglected. Such situations actually occur for $n$ well within 30. One may
increase $r_{max}$ when highly excited states are needed. One
must also increase the number of grid points (the default is 420) as well, to
ensure the accuracy for numerical integration. However, wavefunctions
beyond $Z_{eff}r > 10^{3}$ are rarely needed, either because the interaction
operators are negligible, or because the states that interact with
such highly excited orbitals have negligible amplitudes at large distances. 

In our program, the low-$n$ and high-$n$ states are treated differently.
The dividing $n_0$ is determined by the choice of $r_{max}$, $n_0 =
0.5*\sqrt{Z_{eff}r_{max}}$. For $n \le n_0$, the orbitals are found by outward
and inward integration of Equation \ref{eq_Ga} with zero amplitudes at both
ends, 
and matching at the outer classical turning point. Node counting is used to
pick out the correct solution. The wavefunctions are then normalized by
numerical integration. For $n > n_0$, Equation \ref{eq_Ga} is integrated
outward until $r_{core}$ where the potential has reached its asymptotic
Coulomb value. For $r > r_{core}$, the wavefunction is the exponentially
decaying Whittaker function 
\begin{equation}
y_5(\nu, \lambda, \rho) = W_{\nu, \lambda+1/2}(2\rho/\nu),
\end{equation}
where $\nu^2 = -\frac{1}{2}Z_{eff}^2/\varepsilon$, $\rho = Z_{eff}r$, and
$\lambda = l$ in the non-relativistic limit \citep{seaton58}. In the
relativistic case, the asymptotic behavior of the effective potential is
modified according to Equation \ref{eq_UW}, and corresponds to 
\begin{eqnarray}
Z_{eff}^\prime &=& Z_{eff}(1+\alpha^2\varepsilon) \nonumber\\
\nu^2 &=& -\frac{Z_{eff}^{\prime 2}}{2\varepsilon
\left(1+\frac{1}{2}\alpha^2\varepsilon\right)} \nonumber\\
\lambda(\lambda+1) &=& l(l+1) - (Z_{eff}\alpha)^2 .
\end{eqnarray}
The Whittakar function and its derivative at $r_{core}$ are calculated
using the program of \citet{thompson85} and matched to the solution obtained
by outward integration. The program of \citet{thompson85} uses
quadrupole precision floating point numbers in the calculation of 
hypergeometric function to achieve the desired accuracy. Since not all
platforms implement the quadrupole precision floating point numbers natively,
we have modified the program to use the multi-precision floating point
arithmetic package of \citet{bailey93} to increase the portability. Since for
highly excited states, the quantum defect is 
small, the solution with $\nu \sim n$ is picked out without node counting. To
normalize the wavefunction, we note that the correct normalization is given by
\citep{seaton58}
\begin{equation}
F(r > r_{core}) = K(\nu_n, \lambda)y_5(\nu_n, \lambda, \rho),
\end{equation}
where 
\begin{equation}
K(\nu,\lambda) =
Z_{eff}^{\prime 1/2}\left[\zeta(\nu_n)\nu_n^2\Gamma(\nu_n+\lambda+1)
\Gamma(\nu_n-\lambda)\right]^{-1/2}, 
\end{equation}
and 
\begin{equation}
\zeta(\nu_n) = 1 + \frac{\d\mu}{\d\nu},
\end{equation}
and $\mu$ is the quantum defect. For high $n$ states we are concerned with,
$\zeta(\nu_n) = 1$ is a very good approximation. 

\subsection{Angular Integration and Hamiltonian Matrix Elements}
In Equation \ref{eq_hamilton}, the first term of the Hamiltonian is a
one-electron operator, while the second term is a two-electron operator. The
traditional method of evaluating their matrix elements is to expand them into a
sum, with each term being a product of an angular part and a radial part. The
angular part is then calculated using Racah algebra. In doing so, the initial
and final basis states need to be recoupled, which are often carried out by
the recoupling package of \citet{grant76}. Recently, \citet{gaigalas97}
proposed a new method of performing angular integration, which is based on the
second quantization form of the operators and extends the use of Racah algebra
to the quasi-spin space. In this method, instead of recoupling basis states,
one recouples the creation and annihilation operators in order to apply Racah
algebra. The main advantage of this method 
is that there are only two creation and two annihilation operators in the
two-electron interaction, while for the one-electron interaction, there is
only one 
creation and one annihilation operator. Therefore, at most four angular momenta
are involved in the recoupling independent of the shell structure of the
configurations. In the conventional method, the recoupling of basis states can
be quite complicated for complex configurations. In the present code, the new
method is used.

\subsubsection{One-electron Operator}
The one-electron operator in the Hamiltonian is a scalar, however, we treat a
general tensorial operator $O^L_M = \sum_i o^L_M(i)$ in this section since the
calculation of 
radiative transition rates involves tensors. In second quantization form,
$O^L_M$ may be expressed as 
\begin{equation}
O^L_M = \sum_{\hat{\alpha}\hat{\beta}} a^{\dagger}_{\hat{\alpha}} 
a_{\hat{\beta}} <\hat{\alpha}|o^L_M|\hat{\beta}>,
\end{equation}
where $\hat{\alpha}$ and $\hat{\beta}$ denotes a single electron state
$n\kappa m$.  
$a^{\dagger}$ is the creation operator and $a$ is the annihilation operator. Using
Wigner-Ekart theorem for the matrix element of $o^L_M$ we have 
\begin{equation}
O^L_M = \sum_{\alpha\beta} Z^L_M(\alpha,\beta) 
<\alpha||o^L||\beta>,
\end{equation}
where $<\alpha||o^L||\beta>$ denotes the reduced matrix element, and
$\alpha$ and $\beta$ denote only quantum numbers $n\kappa$. The
summation over $m$ is already contained in $Z^L_M$, which is defined as
\begin{equation}
Z^L_M(\alpha,\beta) = 
-[L]^{-1/2}\left[a^{\dagger}_{\hat{\alpha}} \times \tilde{a}_{\hat{\beta}}\right]^L_M,
\end{equation}
where $[L] = 2L+1$, and $\tilde{a}_{\hat{\beta}} = (-1)^{j_\beta -
m_\beta}a_{-\hat{\beta}}$ 
with $-\hat{\beta}$ being understood as the single electron state
$n_\beta\kappa_\beta -\!m_\beta$, i.e., having the magnetic quantum number
negated. Such a transformation is necessary   
since it is $\tilde{a}_{\hat{\beta}}$ that form an irreducible tensorial set
with rank 
$j_\beta$ \citep{judd67}. The tensorial coupling has the usual meaning. The
angular integration is equivalent to the 
evaluation of the reduced matrix elements of $Z^L_M$ between basis states 
\citep{gaigalas97}. 

\subsubsection{Two-electron Operator}
After some algebraic manipulation \citep{barshalom88}, the
electro-static interaction between electrons can be written as 
\begin{eqnarray}
\label{eq_2e}
\sum_{i<j} \frac{1}{r_{ij}} = \frac{1}{2}
\sum_{\alpha\beta\gamma\delta}
\sum_{k} &\Bigg\{& Z^k(\alpha,\gamma)\cdot Z^k(\beta,\delta)
-(-1)^{j_\alpha-j_\beta}[j_\alpha]^{-1/2}Z^0_0(\alpha\delta)\Bigg\}\nonumber\\
&\times&X^k(\alpha\beta;\gamma\delta),
\end{eqnarray}
where $Z^k(\alpha,\gamma)\cdot Z^k(\beta,\delta)$ denotes the scalar product
of the two tensors, and 
\begin{equation}
X^k(\alpha\beta;\gamma\delta) = <\alpha||C^k||\gamma><\beta||C^k||\delta>
R^k(\alpha\beta;\gamma\delta),
\end{equation}
where $C^k$ is the normalized spherical harmonic tensor as defined in
\citet{cowan81}, and $R^k$ is the Slater integral
\begin{equation}
R^k(\alpha\beta;\gamma\delta) = \int \frac{r_<^k}{r_>^{k+1}}
\rho_{\alpha\gamma}(r_1)\rho_{\beta\delta}(r_2)\d r_1 \d r_2.
\end{equation}
The calculation of the 
matrix elements of $Z^k(\alpha,\gamma)\cdot Z^k(\beta,\delta)$ follows
\citet{gaigalas97} 

\subsection{Large Scale Configuration Interaction}
It is sometimes necessary to carry out calculations with a very large number of
interacting configurations. Since the dimension of the Hamiltonian matrix
grows very rapidly as the number of the interacting configurations
increases, such large
scale calculations easily become unrealistic due to the insufficient CPU time
and memory. In FAC, we use an approximate procedure to deal with such
situations. In most cases, one is only interested in a small subset of the
energy levels resulting from the large configuration space. The
majority of the configurations are included only to provide mixing to the
desired levels. Therefore, we partition the configuration space into two
groups. The first is the main group whose diagonalization provides a good
zeroeth order approximation to the desired energy levels. The second is a
perturbing group whose interaction with the main group is weak, though not
negligible. The Hamiltonian matrix can therefore be partitioned
correspondingly
\begin{equation}
H = \left(\begin{array}{cc}H_1 & B^{\dagger}\\B & H_2\end{array}\right),
\end{equation}
where $H_1$ is the matrix resulting from the main group, and $H_2$ from the
perturbing group. The matrix $B$ and its Hermitian conjugate $B^{\dagger}$
result from the interaction between the two groups. In our approximating
method, only 
the matrix $H_1$, $B$, $B^{\dagger}$, and the diagonal elements of $H_2$ are
retained, i.e., the interaction within the perturbing group is ignored. This
can save large amount of computing time and storage space when the dimension of
$H_2$ is much larger than that of $H_1$. To avoid diagonalizing the large
matrix $H$ directly, we partition the eigenvectors of $H$ accordingly
\begin{equation}
\left(\begin{array}{cc}H_1 & B^{\dagger} \\ B & H_2\end{array}\right) 
\left(\begin{array}{cc}Q_{11} & Q_{12} \\ Q_{21} & Q_{22} \end{array}\right) 
= \left(\begin{array}{cc}Q_{11} & Q_{12} \\ Q_{21} & Q_{22} \end{array}\right)
\left(\begin{array}{cc} D_1 & 0 \\ 0 & D_2 \end{array}\right),
\end{equation}
where the columns of matrix $Q$ are the eigenvectors of $H$, $D_1$ and $D_2$
are diagonal matrices whose elements are the eigenvalues. We are only
interested in the eigenvalues and eigenvectors corresponding to the subspace
of the main group, i.e, the matrices $D_1$, $Q_{11}$, and $Q_{21}$. These
matrices satisfy the following equations
\begin{eqnarray}
\label{eq_partition}
H_1 Q_{11} + B^{\dagger}Q_{21} &=&  Q_{11} D_1 \nonumber \\
B Q_{11} + H_2 Q_{21} &=& Q_{21} D_1 .
\end{eqnarray}
The second relation of Equation \ref{eq_partition} results in 
\begin{equation}
\label{eq_Q21}
Q_{21}^{i} = (D_1^{i} - H_2)^{-1}B Q_{11}^{i},
\end{equation}
where $Q_{21}^{i}$ and $Q_{11}^{i}$ are the $i$-th columns of $Q_{21}$ and
$Q_{11}$, $D_1^{i}$ is the $i$-th diagonal element of $D_1$. Combined with the
first relation of Equation \ref{eq_partition}, the eigenvalues and
eigenvectors can 
be solved iteratively starting with $Q_{21} = 0$, $D_1$ and $Q_{11}$ being the
eigenvalues and eigenvectors of $H_1$. During each step, one needs to
diagonalize the matrix $Q_{11}^{T} H_1 Q_{11} + Q_{11}^{T}B^{\dagger}Q_{21}$,
which 
has the same dimension as $H_1$. Since $H_2$ is diagonal, the matrix
inversion in Equation \ref{eq_Q21} is trivial. Practically, if the partition
between the two groups is carefully chosen, a single iteration yields
sufficiently accurate eigenvalues and eigenvectors.

\subsection{Radiative Transition Rates}
The radiative transition rates are calculated in the single multipole
approximation. This means that the interference between different multipoles
is not taken into account, although rates corresponding to arbitrary
multipoles can be calculated. For a given multipole operator $O^L_M$, and
initial and final states of 
the transition $\psi_i = \sum_\nu b_{i\nu}\Phi_\nu$ and $\psi_f = \sum_\mu
b_{f\mu}\Phi_\mu$, the line strength of the transition is 
\begin{eqnarray}
S_{fi} &=& \left|<\psi_f||O^L_M||\psi_i>\right|^2 \nonumber\\
&=& \left|\sum_{\mu\nu}b_{f\mu}b_{i\nu}\sum_{\alpha\beta}
<\Phi_\mu||Z^L_M(\alpha,\beta)||\Phi_\nu><\alpha||C^L||\beta>
M^L_{\alpha\beta}\right|^2 ,
\end{eqnarray} 
where $M^L_{\alpha\beta}$ is the radial part of the single-electron multipole
operator as defined by \citet{grant74}.
The weighted oscillator strength and transition rates are given by 
\begin{eqnarray}
gf_{fi} &=& [L]^{-1}\omega(\alpha\omega)^{2L-2} S_{fi} \\
gA_{fi} &=& 2\alpha^3 \omega^2 gf_{fi},
\end{eqnarray}
where $\omega = E_i - E_f$ is the transition energy. 

$M^L_{\alpha\beta}$ may be calculated using the fully relativistic
expression of \citet{grant74}. However, in most cases, their non-relativistic
limits are sufficiently accurate, which has the advantage that these operators
depend on the transition energy in a trivial manner. 

\section{Installation and User Interface}
\label{sec_program}
The present code has an unusual structure. The core subroutines that
perform the numerical computation are written as a library independent of the
user interface. A scripting language is used to interface with these numerical
subroutines. This allows maximum flexibility in specifying the problem and
scheduling the computation. The scripting engine we choose is Python, 
which is free software and available for most
platforms. Python has the reputation of having clear syntax, rich run time
service and good documentation. Only minimum knowledge is assumed to write
scripts to perform atomic calculations using FAC, not much beyond the tutorial
that comes with the Python distribution. In this section, we discuss the
installation of FAC and the important routines relevant to atomic structure
calculations that interface with the core numerical library.

\subsection{Installation}
FAC is written primary for Unix systems. It should work with any Unix variants,
including Linux. However, the only operating system dependence lies in the
integration of Python and the core numerical library. Porting to 
non-Unix systems should be relatively simple. 

First, Python should be installed, which can be obtained from
www.python.org. FAC should work with Python 1.5 or higher. There is a Makefile
included in the FAC distribution. Minimal modification is needed according to
the user's system, such as the location of Python header files, the system
library path, and the location where the FAC modules are to be
installed. After these 
modification, installation is as simple as typing ``make all; make install''. 

There are some example scripts in the directory ``demo/'', and documentations
under directory ``doc/''. Users are recommended to consult the contents of
these directories, in addition to this paper. 

\subsection{User Interface}
First, the atomic system under investigation needs to be specified. This is
achieved by calling ``fac.SetAtom(atom)'', where ``atom'' is the atomic
symbol. Any atom in the periodic table with $Z \le 109$ may be specified. 

The electronic configurations that are involved in the physical processes are
specified by two calls, ``config.closed(s)'' and ``config.config(s, group =
g)''. The first specifies whether there are closed shells common to all
configurations. The argument ``s'' is the closed subshell in either
relativistic or non-relativistic notation. If a non-relativistic notation is
used, all possible relativistic subshells are constructed and considered
closed. This routine may be called multiple times to specify more than one
closed shell. The second routine specifies a configuration ``s'' that belongs
to the group ``g''. The group name can be used to reference its configurations
later in the scripts. The configuration ``s'' is a string that consists of a
sequence of shells. For each shell, the principal quantum 
number comes first, followed by the orbital angular momentum $l$. A ``*'' may
be used to specify $l$ instead of the detailed spectroscopic notation, which
means $l$ may assume any allowed value. After $l$,  a ``$\pm$'' sign
indicates the shell is relativistic with $j$ = $l\pm 1/2$. It may be absent,
which means $j$ may take either value. The occupation number after $j$ may
also be absent assuming a single electron. For any given configuration, the
closed shells specified before are added in front of it. For example, ``1s2
2*3'' denotes all configurations of the type $1s^22s^22p$, $1s^22s2p^2$, and
$1s^22p^3$, and ``2s1 2p3 3*1'' denotes all configurations of the type
$2s2p^33s$, $2s2p^33p$, and $2s2p^33d$ with a possible closed shell $1s^2$ in
front of them. For each configuration specified, all possible basis states
are constructed by coupling the angular momenta in the standard $jj$ coupling
scheme. 

The central potential $V(r)$ is obtained by a self-consistent Dirac-Fock-Slater
iteration as described in \S\ref{sec_theory}. The routine
``fac.OptimizeRadial(groups)'' performs the iteration, where ``groups'' are a
list of 
groups from which the mean configuration is constructed by distributing the
number of electrons in the active shells according to the statistical weight
of each configuration. For example, if ``groups''
contains two configurations ``1s$^2$ 2s'' and ``1s$^2$ 2p-'', then the mean
configuration would be ``1s$^2$ 2s$^{0.5}$ 2p-$^{0.5}$''. The automatic
construction of the mean configuration described above is usually
adequate. However, if one wishes to investigate the effects of different mean
configurations, the function ``config.avgconfig(s)'' may be called for a
detailed specification, where ``s'' is the same as in ``config.config(s,
group=g)'', with the exception that the occupation numbers may be fractional,
and that the closed shells specified with ``config.closed(s)'' are not added
in front of it. When one makes such a detailed specification,
``fac.OptimizeRadial'' should be called with no argument. 

The routine ``fac.Structure(groups, perturbers)'' sets up the Hamiltonian
matrix and diagonalizes it. Only the mixing within ``groups'' and the mixing
between ``groups'' and ``perturbers'' are retained. The argument
``perturbers'' may be absent if no perturbing groups need to be included. If
the argument ``groups'' is absent as well, all specifid configurations are
assumed to be interacting. This routine may be called 
multiple times with different groups as arguments. The energy levels are
output by a call ``fac.LevelTable(fname)'', where ``fname'' is the output file
name. The results are stored in plain ASCII 
form with each line represents a level. The first column is the level index.
The second is the energy relative to the ground state in the units of eV. The
third and fourth columns are the parity and the total angular momentum of the
level, respectively. The fifth column is the 
level name in a simple form which only indicates the non-relativistic shell
structure, e.g., ``1s2 2s1 2p3''. The sixth column is the level name in a
detailed form which gives the relativistic shell structure and the coupling
information, e.g., ``1s+2(0)0 2s+1(1)1 2p+2(1)0'', where for each shell, the
number in the parenthesis is the total angular momentum of the shell, and the
number after that is the total angular momentum when this shell is coupled to
all preceding ones. All angular momenta are twice their actual values to
represent half integers in the integer form. Levels are identified by the major
mixing component which has the largest mixing coefficient. 

``fac.TransitionTable(lower, upper, fname, multipole)'' is called to calculate
the radiative transition rates, where ``lower'' and
``upper'' specifies the lower levels and upper levels of the transition
array. They may be a list of groups which indicates that all levels within
these groups are included, or a list of level indices corresponds to those in
the output level table. ``fname'' specifies the output file name, and
``multipole'' is an integer specifying the multipole type. A positive integer
represents a magnetic multipole and a negative integer represents an electric
multipole, the absolute value represents the rank. The format of the output
file is self-explanatory. Transition rates can be calculated in different
gauges and using either non-relativistic or relativistic operators. However,
when the relativistic operators are used, the transition energy dependence of
the radial matrix elements are ignored. When non-relativistic expression for
the operators are used, only the Babushkin gauge (length form) is
implemented. These options are set by calling ``fac.TransitionOptions(gauge,
mode, maxe, maxm)'', where ``gauge = 1'' corresponds to Coulomb gauge
(velocity form), ``gauge = 2'' corresponds to Babshkin gauge (length
form). ``mode = 0'' corresponds to relativistic operators and ``mode = 1''
corresponds to non-relativistic limits. ``maxe'' and ``maxm'' are the maximum
rank of electric and magnetic multipoles allowed. The defaults for the options
are used if this routine is not called prior to the calculation of transition
rates, which are ``gauge = 2'', ``mode = 1'', ``maxe = maxm = 4''.

\section{Examples}
\label{sec_example}
A sample script is shown below for the calculation of energy levels and
transition rates of Ne-like iron. The mixing within $n = 2$ and $n = 3$
complexes is included. For transition rates, only allowed transitions between
the ground state and $n = 3$ levels are included. Lines beginning with ``\#''
are comments in Python scripts.
\begin{verbatim}
# import the modules
import config
import fac

fac.SetAtom('Fe')
# 1s shell is closed
config.closed('1s')
config.config('2*8', group = 'n2')
config.config('2*7 3*1', group = 'n3')

# Self-consistent iteration for optimized central potential
fac.OptimizeRadial('n2', 'n3')
fac.Structure()

fac.LevelTable('ne.lev')
fac.TransitionTable(['n2'], ['n3'], 'ne.tr', -1)
\end{verbatim}

\citet{sampson89} compared the results from their atomic structure
code with the MCDF results and found very good agreements. In Table
\ref{tab_comparison} we 
compare our transition energies and oscillator strengths of electric-dipole
allowed transitions to the ground state with
the fully relativistic results of \citet{sampson89}. The difference between
oscillator strengths is seen to be less than 10\%, while the agreement between
energies is very good.

\begin{table}
\caption{\label{tab_comparison} Comparison of transition energies (in eV) and
weighted oscillator strengths for electric-dipole allowed transitions to the
ground state for Ne-like iron. FAC is the present result. FR and FR$^*$ are
the fully relativistic results of \citet{sampson89} with two slightly
different choices of mean configurations in determining the central
potential. The level name abbreviation follows \citet{sampson89}.}

\begin{tabular}{ccccccccc}
\hline\hline
 & Level & FAC $\Delta E$ & FAC $gf$ & 
FR $\Delta E$ & FR $gf$ & FR$^*$ $\Delta E$ & FR$^*$ $gf$ \\
\hline
2 & (2p$_{3/2}$3s$_{1/2}$)$_{1}$ & 726.99 & 0.1214 & 725.92 & 0.1081 & 727.22 & 0.1102 \\
4 & (2p$_{1/2}$3s$_{1/2}$)$_{1}$ & 739.24 & 0.1049 & 738.87 & 0.0922 & 739.50 & 0.0937 \\
16 & (2p$_{3/2}$3d$_{3/2}$)$_{1}$ &802.42 & 0.0103 & 801.27 & 0.0098 & 802.64 & 0.0099 \\
22 & (2p$_{3/2}$3d$_{5/2}$)$_{1}$ &812.88 & 0.6333 & 811.88 & 0.5900 & 813.15 & 0.6095 \\
26 & (2p$_{1/2}$3d$_{3/2}$)$_{1}$ &827.32 & 2.6120 & 826.52 & 2.5516 & 827.69 & 2.5514 \\
30 & (2s$_{1/2}$3p$_{1/2}$)$_{1}$ &894.81 & 0.0338 & 893.89 & 0.0358 & 894.83 & 0.0358 \\
32 & (2s$_{1/2}$3p$_{3/2}$)$_{1}$ &899.18 & 0.2767 & 898.24 & 0.2880 & 899.18 & 0.2868 \\
\hline\hline
\end{tabular}
\end{table}

\section{Conclusions}
We have developed a complete software package for calculating atomic radiative
and collisional processes. The atomic structure part of the package is
presented. Comparison of transition energy and oscillator strengths for
Ne-like iron with the result of existing codes shows very good agreement. The
scripting language interface of our code appears to be simpler and more
flexible than conventional approaches, which makes it possible to be used by
general public in need of large amounts of atomic data, such as astrophysical
community working with x-ray spectra. 

\section*{Acknowledgments}
The author would like to thank Masao Sako for his continuous test of the code
and Ehud Behar, Peter Beiersdorfer, and Mau Chen for their helpful
suggestions. The author also thanks D.H. Bailey 
of NASA Ames Research Center for his multi-precision floating point arithmetic
package included in this software. This work is supported by
NASA through Chandra Postdoctoral Fellowship Award Number PF01-10014 issued by
the Chandra X-ray Observatory Center, which is operated by Smithsonian
Astrophysical Observatory for and on behalf of NASA under contract NAS8-39073.

\bibliographystyle{unsrtnat}
\bibliography{facref}

\end{document}
